<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Wind Turbine Map</title>
    <script>
        // APIロード完了時のコールバック関数を定義
        function initMap() {
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 5,
                center: { lat: 37.0, lng: 137.0 },
                mapTypeId: 'terrain',
                mapTypeControl: true,
                scaleControl: true,
                streetViewControl: false,
                rotateControl: true,
                fullscreenControl: true
            });

            // KMLレイヤーの追加
            const kmlLayer = new google.maps.KmlLayer({
                url: 'https://raw.githubusercontent.com/Shen-322/trust/refs/heads/main/WindMap-Rev1_20240913.kml', // KMLファイルの公開URL
                suppressInfoWindows: false,
                preserveViewport: false,
                map: map
            });

            // エラーメッセージ表示用のdiv
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'absolute';
            errorDiv.style.top = '10px';
            errorDiv.style.left = '10px';
            errorDiv.style.backgroundColor = 'white';
            errorDiv.style.padding = '10px';
            errorDiv.style.border = '1px solid red';
            errorDiv.style.display = 'none';
            document.getElementById('map').appendChild(errorDiv);

            // KMLレイヤーのステータス監視
            kmlLayer.addListener('status_changed', function() {
                const status = kmlLayer.getStatus();
                if (status !== 'OK') {
                    errorDiv.style.display = 'block';
                    errorDiv.innerHTML = `KMLレイヤーの読み込みエラー: ${status}<br>
                        考えられる原因:<br>
                        - KMLファイルのURLが正しくない<br>
                        - KMLファイルがHTTPS経由でアクセスできない<br>
                        - KMLファイルのサイズが制限を超えている<br>
                        - CORSポリシーの制限`;
                } else {
                    errorDiv.style.display = 'none';
                }
            });
        }
    </script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
            width: 100%;
            position: relative;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <!-- APIの読み込みを最適化 -->
    <script async 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdOLHPhmtKJR0QVmYQSoAH0lYnDWpq8nI&callback=initMap">
    </script>
</body>
</html>